
# 🧠 EEG画像嗜好解析システム (EEG Image Preference Analyzer)

**FP1・FP2の2チャネル脳波データとアンケート結果を統合し、画像に対する主観的な嗜好（「好き」「そうでもない」）を多角的に分析・可視化するためのStreamlitアプリケーションです。**
最新の脳波解析手法を取り入れ、研究者や開発者がインタラクティブにデータを探索し、信頼性の高い知見を得ることを目的としています。パスワード認証機能を備え、セキュアな環境でデータを取り扱うことができます。


## ✨ 主な機能

*   **インタラクティブな解析UI**:
    *   フィルタの周波数帯域や品質管理の閾値などを、サイドバーで直感的に調整可能。
    *   パラメータ変更後の再解析がリアルタイムで実行され、結果の変化を即座に確認できます。
    *   プルダウンメニューを操作しても、解析結果が消えることなくスムーズに表示が更新されます。

*   **柔軟なデータ入力**:
    *   **脳波データ**: ラベル情報の有無に関わらず、`.xdf`, `.edf`, `.bdf`, `.fif` など主要な形式に対応。
    *   **評価データ**: 実験の評価結果（好き嫌いやValence/Arousalなど）を`.csv`または`.xlsx`ファイルから読み込み、脳波データと自動でマージします。

*   **高度な特徴量抽出**:
    *   脳波から「パワー（信号の強さ）」と「エントロピー（信号の複雑性）」という2つの側面から特徴量を抽出します。

*   **厳格な品質管理 (QC)**:
    *   振幅閾値と隣接サンプル差に基づいて、ノイズの多い区間（アーチファクト）を自動で検出し、解析から除外。
    *   「Rawデータインスペクター」機能により、生波形と閾値の関係を視覚的に確認でき、適切な閾値設定をサポートします。

*   **信頼性の高い統計解析**:
    *   「好き」vs「そうでもない」のグループ間での特徴量の分布を比較（ボックスプロット）。
    *   t検定によるp値、効果量（Cohen's d）、検定力を算出し、統計的な有意性を示します。

*   **セキュアなアクセス**:
    *   パスワード認証機能を備え、許可されたユーザーのみがアプリケーションにアクセスできます。

---

## 📊 「分析する特徴量」各項目の見方ガイド

生の脳波データは単なる波形ですが、そこから意味のある情報を引き出すために「特徴量」を計算します。このアプリのプルダウンメニューに表示される各特徴量は、**3つの要素**を組み合わせた名前になっています。このルールを理解すれば、すべての項目を読み解くことができます。

### 命名規則の基本形

多くの場合、特徴量は以下のいずれかの形式で命名されています。

1.  **`[場所]_[指標]_[処理]`** （例: `FP1_alpha_power_ratio`）
2.  **`[指標]_[処理]`** （例: `alpha_power_asymmetry`）

---

### 【要素解説】

#### 1. 場所 (FP1 / FP2)

脳波を測定した電極の位置を示します。
*   `FP1_...`: **左脳の前頭部**で測定した値です。
*   `FP2_...`: **右脳の前頭部**で測定した値です。

#### 2. 指標 (何を測ったか？)

脳波のどのような特性を計算したかを示します。

##### ▼ パワー系指標 (脳活動の「量」や「強さ」)
| 指標名 | 周波数 | 関連する脳の状態 |
| :--- | :--- | :--- |
| **`theta_power`** | 4-7 Hz | **集中・記憶・感情的な関与**。何かに深く注意を向けているとき、特に前頭部でパワーが増加します。 |
| **`alpha_power`** | 8-13 Hz | **リラックス・非活動状態**。眼を閉じている時に強く、注意を払うと減少します。感情研究では、左右のパワー差（非対称性）が**ポジティブ／ネガティブ感情**の重要な指標とされます。 |
| **`beta_power`** | 13-30 Hz | **覚醒・活発な思考・注意状態**。集中しているときや、逆にストレスを感じているときにパワーが増加することがあります。 |

##### ▼ エントロピー系指標 (脳活動の「質」や「複雑性」)
| 指標名 | 測るもの | 直感的なイメージ |
| :--- | :--- | :--- |
| **`differential_entropy`** | **信号のばらつき** | パワーと似ていますが、情報量として扱えるため、機械学習モデルなどで安定した性能を発揮します。 |
| **`permutation_entropy`** | **パターンの多様性** | 信号波形が単調で予測しやすい（例: きれいなサイン波）と値が**低く**、不規則で予測しにくいと値が**高く**なります。 |
| **`spectral_entropy`** | **周波数分布の均一さ** | パワーが特定の周波数に集中している（例: α波だけが強い）と値が**低く**、様々な周波数が均等に混ざっていると値が**高く**なります。 |

#### 3. 処理 (どう加工したか？)

個人差をなくし、意味のある比較をするための加工方法です。

| 処理名 | 解説 | 計算式 |
| :--- | :--- | :--- |
| **`..._ratio`** | **ベースライン比**。「平常時」と比べて、刺激中に特徴量が**何%変化したか**を示します。 | `(刺激時の値 - 平常時の値) / 平常時の値` |
| **`..._asymmetry`** | **左右非対称性**。左脳と右脳の**活動量の差**を示します。特に感情研究で重要です。 | `(右脳の変化率) - (左脳の変化率)` |

---

### 【特に注目すべき代表的な特徴量】

| 特徴量名 | 何を調べるのに特に有効か？ | 期待される結果の例 |
| :--- | :--- | :--- |
| **`alpha_power_asymmetry`** | **感情の方向性（ポジティブ vs ネガティブ）** | **正の値が大きいほど**、左脳が相対的に活発化しており、**ポジティブな感情や「やってみたい」という接近動機**と関連するとされています。 |
| **`FP1_theta_power_ratio`<br>`FP2_theta_power_ratio`** | **刺激への関与度・集中度** | 「好き」と感じる興味深い刺激に対しては、この値が**正の方向に大きく**なり、θ波の活動が増加すると期待されます。 |
| **`FP1_alpha_power_ratio`<br>`FP2_alpha_power_ratio`** | **脳の覚醒度・情報処理の活発さ** | 興味深い刺激に対しては、脳が活発に情報処理を行うため、この値が**負の方向に大きく**なる（α波が強く減少する）と期待されます。 |

---

## 🛠️ 使用技術

| カテゴリ | ライブラリ・ツール |
| :--- | :--- |
| **Webフレームワーク** | `Streamlit` |
| **脳波解析** | `MNE-Python` |
| **数値演算** | `NumPy`, `SciPy` |
| **エントロピー計算** | `antropy` |
| **統計解析** | `Pingouin`, `SciPy.stats` |
| **データ操作** | `Pandas` |
| **可視化** | `Plotly` |
| **データ検証** | `Pydantic` |
| **XDF対応** | `pyxdf` |
| **デプロイ** | `Streamlit Cloud` |

